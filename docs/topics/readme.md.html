<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>DNS client for OpenResty</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>lua-resty-dns-client</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Topics</h2>
<ul class="">
  <li><strong>readme</strong></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/resty.dns.balancer.html">resty.dns.balancer</a></li>
  <li><a href="../modules/resty.dns.client.html">resty.dns.client</a></li>
  <li><a href="../modules/resty.dns.utils.html">resty.dns.utils</a></li>
</ul>

</div>

<div id="content">

    <h1>Overview</h1>

<p>Lua library containing a dns client, several utilities, and a load-balancer.</p>

<p>The module is currently OpenResty only, and builds on top of the
<a href="https://github.com/openresty/lua-resty-dns"><code>lua-resty-dns</code></a> library</p>

<h1>Features</h1>

<ul>
<li>resolves A, AAAA, CNAME and SRV records, including port</li>
<li>parses <code>/etc/hosts</code></li>
<li>parses <code>/resolv.conf</code> and applies <code>LOCALDOMAIN</code> and <code>RES_OPTIONS</code> variables</li>
<li>caches dns query results in memory</li>
<li>synchronizes requests (a single request for many requestors, eg. when cached ttl expires under heavy load)</li>
<li><code>toip</code> applies a local (weighted) round-robin scheme on the query results</li>
<li>ring-balancer for round-robin and consistent-hashing approaches</li>
</ul>


<h1>Copyright and license</h1>

<p>Copyright: &copy; 2016-2017 Mashape, Inc.</p>

<p>Author: Thijs Schreijer</p>

<p>License: <a href="https://opensource.org/licenses/Apache-2.0">Apache 2.0</a></p>

<h1>Testing</h1>

<p>Tests are executed using <code>busted</code>, but because they run inside the <code>resty</code> cli tool, you must
use the <code>rbusted</code> script.</p>

<h1>History</h1>

<h3>0.4.1 (21-Apr-2017) Bugfix</h3>

<ul>
<li>fix: cname record caching causing excessive dns queries
See <a href="https://github.com/Mashape/kong/issues/2303">Kong issue #2303</a></li>
</ul>


<h3>0.4.0 (30-Mar-2017) Bugfixes</h3>

<ul>
<li>Change: BREAKING! modified hash treatment, must now be an integer > 0</li>
<li>Added: BREAKING! a retry counter to fall-through on hashed-retries (changes
the <code>getpeer</code> signature)</li>
<li>Fix: the MAXNS (3) was not honoured, so more than 3 nameservers would be parsed
from the <code>resolv.conf</code> file. Fixes <a href="https://github.com/Mashape/kong/issues/2290">Kong issue #2290</a>.</li>
<li>Added: two convenience hash functions</li>
<li>Performance: some improvements (pre-allocated tables for the slot lists)</li>
</ul>


<h3>0.3.2 (6-Mar-2017) Bugfixes</h3>

<ul>
<li>Fix: Cleanup disabled addresses but did not delete them, causing errors when
they were repeatedly added/removed</li>
<li>Fix: potential racecondition when re-querying dns records</li>
<li>Fix: potential memoryleak when a balancer object was released with a running timer</li>
</ul>


<h3>0.3.1 (22-Feb-2017) Bugfixes</h3>

<ul>
<li>Kubernetes dns returns an SRV record for individual nodes, where the target
is the same name again (hence causing a recursive loop). Now those entries
will be removed, and if nothing is left, it will fail the SRV lookup, causing
a fall-through to the next record type.</li>
<li>Kubernetes tends to return a port of 0 if none is provided/set, hence the
<code>toip()</code> function now ignores a <code>port=0</code> and falls back on the port passed
in.</li>
</ul>


<h3>0.3.0 (8-Nov-2016) Major breaking update</h3>

<ul>
<li>breaking: renamed a lot of things; method names, module names, etc. pretty
much breaks everything&hellip; also releasing under a new name</li>
<li>feature: udp function <code>setpeername</code> added (client)</li>
<li>fix: do not synchronize dns queries for ttl=0 requests (client)</li>
<li>fix: full test coverage and accompanying fixes (ring-balancer)</li>
<li>feature: auto-retry for failed dns queries (ring-balancer)</li>
<li>feature: updating weights is now supported without removing/re-adding (ring-balancer)</li>
<li>change: auto-retry interval configurable for failed dns queries (ring-balancer)</li>
<li>change: max life-time interval configurable for ttl=0 dns records (ring-balancer)</li>
</ul>


<h3>0.2.1 (24-Oct-2016) Bugfix</h3>

<ul>
<li>fix: <code>toip()</code> failed on SRV records with only 1 entry</li>
</ul>


<h3>0.2 (18-Oct-2016) Added the balancer</h3>

<ul>
<li>fix: was creating resolver objects even if serving from cache</li>
<li>change: change resolver order (SRV is now first by default) for dns servers that create both SRV and A records for each entry</li>
<li>feature: make resolver order configurable</li>
<li>feature: ring-balancer (experimental, no full test coverage yet)</li>
<li>other: more test coverage for the dns client</li>
</ul>


<h3>0.1 (09-Sep-2016) Initial released version</h3>

</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2017-04-21 10:40:30 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
